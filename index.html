<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Scoreboard Dashboard</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Google Fonts: Press Start 2P & Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a;
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
            color: #e0e0e0;
        }
        .font-pixel {
            font-family: 'Press Start 2P', cursive;
        }
        .panel {
            background: rgba(26, 26, 26, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .scan-button {
            transition: all 0.3s ease;
        }
        .scan-button:hover {
            transform: translateY(-3px) scale(1.05);
        }
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        .team-input {
            background: transparent;
            border: none;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            font-size: 1.5rem; /* Adjusted font size */
            line-height: 2rem;
            font-weight: 700;
            width: 100%;
            padding-bottom: 0.5rem;
            outline: none;
            transition: border-color 0.3s ease;
        }
        .team-input:focus {
            border-bottom-color: #fff;
        }
        .color-picker {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 40px;
            height: 40px;
            background-color: transparent;
            border: none;
            cursor: pointer;
        }
        .color-picker::-webkit-color-swatch {
            border-radius: 50%;
            border: 2px solid #fff;
        }
        .color-picker::-moz-color-swatch {
            border-radius: 50%;
            border: 2px solid #fff;
        }
        .manual-score-input {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            text-align: center;
            width: 100%;
            padding: 8px;
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
            -moz-appearance: textfield; /* Firefox */
        }
        .manual-score-input::placeholder { color: rgba(255, 255, 255, 0.4); }
        .manual-score-input:focus { border-color: #fff; }
        .manual-score-input::-webkit-outer-spin-button,
        .manual-score-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #555; }
        
        #gamble-reel {
            text-shadow: 0 0 10px #facc15, 0 0 20px #facc15;
        }
        
        @keyframes switch-color {
          0%, 49.9% {
            color: #ffffff;
            text-shadow: 0 0 5px rgba(255,255,255,0.5);
          }
          50%, 99.9% {
            color: var(--team-color, #ffffff);
            text-shadow: 0 0 20px var(--team-color, #ffffff);
          }
          100% {
            color: #ffffff;
            text-shadow: 0 0 5px rgba(255,255,255,0.5);
          }
        }
        .score-blinking {
          animation: switch-color 2s infinite steps(1, end);
        }
        
        @keyframes event-fade-in {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .event-banner {
            animation: event-fade-in 0.5s ease-out forwards;
        }

        @keyframes wave {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .title-char {
            display: inline-block;
            animation: wave 2s infinite ease-in-out;
        }
    </style>
</head>
<body class="p-2 sm:p-4">

    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-2">
            <h1 id="main-title" class="font-pixel text-2xl sm:text-3xl text-yellow-400 tracking-widest" style="text-shadow: 0 0 10px #facc15;">
                <!-- Title will be generated by JS -->
            </h1>
            <p class="text-gray-300 mt-1 text-xs sm:text-sm">‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡πÑ‡∏£‡πâ‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô</p>
        </header>

        <!-- Top Controls Section -->
        <div class="flex flex-col sm:flex-row justify-between items-center gap-2 mb-4">
            <div class="flex gap-2">
                <button id="summary-button" class="panel p-3 h-full bg-purple-600 hover:bg-purple-700 rounded-lg transition flex-shrink-0">
                    <div class="flex items-center justify-center gap-2">
                        <i class="fa-solid fa-trophy text-lg"></i>
                        <span class="font-bold text-sm">‡∏™‡∏£‡∏∏‡∏õ</span>
                    </div>
                </button>
                <button id="reset-game-button" class="panel p-3 h-full bg-red-800 hover:bg-red-700 rounded-lg transition flex-shrink-0">
                    <div class="flex items-center justify-center gap-2">
                        <i class="fa-solid fa-power-off text-lg"></i>
                        <span class="font-bold text-sm">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</span>
                    </div>
                </button>
            </div>
             <!-- Bank Section -->
            <div class="panel p-2 text-center">
                <h3 class="text-xs font-bold text-green-400">üí∞ ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ üí∞</h3>
                <p id="bank-score" class="font-pixel text-base text-green-300">1,000,000,000,000</p>
            </div>
            <div class="panel p-2 flex gap-2">
                 <button id="troll-robinhood" class="px-3 py-2 bg-green-600/50 hover:bg-green-600/80 rounded-md transition" title="‡πÇ‡∏£‡∏ö‡∏¥‡∏ô‡∏Æ‡∏π‡πâ‡∏î"><i class="fa-solid fa-user-secret"></i></button>
                 <button id="troll-blind-bet" class="px-3 py-2 bg-yellow-600/50 hover:bg-yellow-600/80 rounded-md transition" title="‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏ï‡∏≤‡∏ö‡∏≠‡∏î"><i class="fa-solid fa-eye-slash"></i></button>
                 <button id="troll-random" class="px-3 py-2 bg-red-600/50 hover:bg-red-600/80 rounded-md transition" title="‡πÇ‡∏ä‡∏Ñ‡∏ä‡∏∞‡∏ï‡∏≤"><i class="fa-solid fa-shuffle"></i></button>
            </div>
        </div>


        <!-- Special Event Banner -->
        <div id="event-banner-container" class="min-h-[50px] mb-4"></div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6">
            <!-- Team 1 Panel -->
            <div id="team1-panel" class="panel p-4 flex flex-col items-center space-y-2" style="border-color: #38bdf8;">
                <div class="w-full flex justify-center items-center gap-2">
                    <input type="text" id="team1-name" value="Blue Team" class="team-input" style="color: #38bdf8;">
                    <span id="team1-leader-indicator" class="text-yellow-400 text-2xl"></span>
                    <input type="color" id="team1-color" value="#38bdf8" class="color-picker">
                </div>
                <p class="font-pixel text-3xl sm:text-4xl font-bold text-white break-all" id="team1-score">100,000</p>
                <p class="text-gray-400 text-sm">POINTS</p>
                <div id="team1-debt-display" class="text-red-500 font-bold text-sm min-h-[20px]"></div>
                <div class="w-full max-w-xs pt-2 space-y-2">
                    <input type="number" id="team1-manual-score" class="manual-score-input" placeholder="Add/Sub Score & Enter">
                    <div class="flex gap-2">
                         <input type="number" id="team1-buy-amount" class="manual-score-input w-1/3" placeholder="Qty">
                         <button class="w-2/3 py-2 text-sm font-bold rounded-lg bg-blue-500 hover:bg-blue-600 transition text-white" onclick="handleBuyCards(1)">
                            <i class="fa-solid fa-cart-shopping"></i> ‡∏ã‡∏∑‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡πå‡∏î (50k)
                        </button>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <button class="w-full py-2 text-sm font-bold rounded-lg bg-yellow-500 hover:bg-yellow-600 transition text-gray-900" onclick="handleGamble(1)">
                            <i class="fa-solid fa-dice"></i> ‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô
                        </button>
                        <div id="team1-loan-container">
                            <button class="w-full py-2 text-sm font-bold rounded-lg bg-green-500 hover:bg-green-600 transition text-gray-900" onclick="handleLoan(1)">
                                <i class="fa-solid fa-hand-holding-dollar"></i> ‡∏Å‡∏π‡πâ‡∏¢‡∏∑‡∏°
                            </button>
                        </div>
                    </div>
                     <button class="w-full py-2 text-sm font-bold rounded-lg bg-gray-800 hover:bg-gray-700 border border-yellow-500 transition text-yellow-400" onclick="handleBlackMarket(1)">
                        <i class="fa-solid fa-store"></i> ‡∏ï‡∏•‡∏≤‡∏î‡∏°‡∏∑‡∏î (250k)
                    </button>
                </div>
                <div class="w-full mt-auto pt-4">
                    <input type="text" id="team1-rfid-input" class="manual-score-input font-pixel text-lg py-3" placeholder="‡πÅ‡∏ï‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î RFID ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
                </div>
            </div>

            <!-- Team 2 Panel -->
            <div id="team2-panel" class="panel p-4 flex flex-col items-center space-y-2" style="border-color: #ec4899;">
                <div class="w-full flex justify-center items-center gap-2">
                    <input type="text" id="team2-name" value="Pink Team" class="team-input" style="color: #ec4899;">
                    <span id="team2-leader-indicator" class="text-yellow-400 text-2xl"></span>
                    <input type="color" id="team2-color" value="#ec4899" class="color-picker">
                </div>
                <p class="font-pixel text-3xl sm:text-4xl font-bold text-white break-all" id="team2-score">100,000</p>
                <p class="text-gray-400 text-sm">POINTS</p>
                 <div id="team2-debt-display" class="text-red-500 font-bold text-sm min-h-[20px]"></div>
                <div class="w-full max-w-xs pt-2 space-y-2">
                    <input type="number" id="team2-manual-score" class="manual-score-input" placeholder="Add/Sub Score & Enter">
                    <div class="flex gap-2">
                         <input type="number" id="team2-buy-amount" class="manual-score-input w-1/3" placeholder="Qty">
                         <button class="w-2/3 py-2 text-sm font-bold rounded-lg bg-blue-500 hover:bg-blue-600 transition text-white" onclick="handleBuyCards(2)">
                            <i class="fa-solid fa-cart-shopping"></i> ‡∏ã‡∏∑‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡πå‡∏î (50k)
                        </button>
                    </div>
                     <div class="grid grid-cols-2 gap-2">
                        <button class="w-full py-2 text-sm font-bold rounded-lg bg-yellow-500 hover:bg-yellow-600 transition text-gray-900" onclick="handleGamble(2)">
                            <i class="fa-solid fa-dice"></i> ‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô
                        </button>
                        <div id="team2-loan-container">
                             <button class="w-full py-2 text-sm font-bold rounded-lg bg-green-500 hover:bg-green-600 transition text-gray-900" onclick="handleLoan(2)">
                                <i class="fa-solid fa-hand-holding-dollar"></i> ‡∏Å‡∏π‡πâ‡∏¢‡∏∑‡∏°
                            </button>
                        </div>
                    </div>
                     <button class="w-full py-2 text-sm font-bold rounded-lg bg-gray-800 hover:bg-gray-700 border border-yellow-500 transition text-yellow-400" onclick="handleBlackMarket(2)">
                        <i class="fa-solid fa-store"></i> ‡∏ï‡∏•‡∏≤‡∏î‡∏°‡∏∑‡∏î (250k)
                    </button>
                </div>
                <div class="w-full mt-auto pt-4">
                    <input type="text" id="team2-rfid-input" class="manual-score-input font-pixel text-lg py-3" placeholder="‡πÅ‡∏ï‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î RFID ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
                </div>
            </div>
        </div>

        <div class="mt-8">
            <div class="panel p-6">
                <h3 class="font-pixel text-xl mb-4 text-center text-yellow-400">BATTLE LOG</h3>
                <ul id="chaos-feed" class="space-y-4 h-[250px] overflow-y-auto custom-scrollbar pr-2"></ul>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="alert-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center opacity-0 pointer-events-none z-50">
        <div class="modal-content panel p-8 text-center transform scale-95 flex flex-col items-center max-w-sm">
            <div id="alert-icon" class="text-5xl mb-4"></div>
            <h3 id="alert-title" class="font-pixel text-2xl text-white mb-2"></h3>
            <p id="alert-message" class="text-gray-300 mb-6"></p>
            <div id="alert-buttons" class="flex gap-4">
                <button id="close-alert-button" class="bg-blue-600 text-white font-bold py-2 px-8 rounded-lg hover:bg-blue-700 transition">OK</button>
            </div>
        </div>
    </div>
    
    <div id="gamble-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center opacity-0 pointer-events-none z-50">
        <div class="modal-content panel p-8 text-center transform scale-95 flex flex-col items-center max-w-md w-full">
            <h3 class="font-pixel text-2xl text-white mb-4">üé≤ ‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô üé≤</h3>
            <div id="gamble-reel" class="font-pixel text-6xl text-yellow-400 my-8">000000</div>
            <div id="gamble-result" class="hidden">
                 <p class="text-gray-300 mb-6"></p>
                 <button id="close-gamble-button" class="bg-blue-600 text-white font-bold py-2 px-8 rounded-lg hover:bg-blue-700 transition">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>
    
    <div id="summary-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center opacity-0 pointer-events-none z-50">
        <div class="modal-content panel p-8 text-center transform scale-95 flex flex-col items-center max-w-lg w-full">
            <h3 class="font-pixel text-2xl text-white mb-6">üèÜ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• üèÜ</h3>
            <div id="summary-winner" class="mb-4"></div>
            <div id="summary-loser" class="mb-6"></div>
            <div id="summary-punishment" class="border-t border-gray-700 pt-6"></div>
            <button id="close-summary-button" class="mt-8 bg-blue-600 text-white font-bold py-2 px-8 rounded-lg hover:bg-blue-700 transition hidden">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>


    <script>
        const teams = {
            1: { name: 'Blue Team', color: '#38bdf8', score: 100000, debt: null },
            2: { name: 'Pink Team', color: '#ec4899', score: 100000, debt: null }
        };
        
        let bankScore = 1000000000000;

        let activeTeam = null;
        const feedEvents = [];
        let lastCardAction = { teamId: null, barcode: null };
        
        let audioCtx;
        let currentEvent = null;
        
        const elements = {
            mainTitle: document.getElementById('main-title'),
            team1: { panel: document.getElementById('team1-panel'), name: document.getElementById('team1-name'), color: document.getElementById('team1-color'), score: document.getElementById('team1-score'), manualScore: document.getElementById('team1-manual-score'), leaderIndicator: document.getElementById('team1-leader-indicator'), debtDisplay: document.getElementById('team1-debt-display'), loanContainer: document.getElementById('team1-loan-container'), buyAmountInput: document.getElementById('team1-buy-amount'), rfidInput: document.getElementById('team1-rfid-input') },
            team2: { panel: document.getElementById('team2-panel'), name: document.getElementById('team2-name'), color: document.getElementById('team2-color'), score: document.getElementById('team2-score'), manualScore: document.getElementById('team2-manual-score'), leaderIndicator: document.getElementById('team2-leader-indicator'), debtDisplay: document.getElementById('team2-debt-display'), loanContainer: document.getElementById('team2-loan-container'), buyAmountInput: document.getElementById('team2-buy-amount'), rfidInput: document.getElementById('team2-rfid-input') },
            feed: document.getElementById('chaos-feed'),
            summaryButton: document.getElementById('summary-button'),
            resetGameButton: document.getElementById('reset-game-button'),
            trollRobinhoodButton: document.getElementById('troll-robinhood'),
            trollBlindBetButton: document.getElementById('troll-blind-bet'),
            trollRandomButton: document.getElementById('troll-random'),
            alertModal: document.getElementById('alert-modal'),
            alertIcon: document.getElementById('alert-icon'),
            alertTitle: document.getElementById('alert-title'),
            alertMessage: document.getElementById('alert-message'),
            alertButtons: document.getElementById('alert-buttons'),
            closeAlertButton: document.getElementById('close-alert-button'),
            gambleModal: document.getElementById('gamble-modal'),
            gambleReel: document.getElementById('gamble-reel'),
            gambleResult: document.getElementById('gamble-result'),
            closeGambleButton: document.getElementById('close-gamble-button'),
            eventBannerContainer: document.getElementById('event-banner-container'),
            summaryModal: document.getElementById('summary-modal'),
            summaryWinner: document.getElementById('summary-winner'),
            summaryLoser: document.getElementById('summary-loser'),
            summaryPunishment: document.getElementById('summary-punishment'),
            closeSummaryButton: document.getElementById('close-summary-button'),
            bankScore: document.getElementById('bank-score'),
        };
        
        const cardDatabase = {
            '0001': { emoji: 'üí∞', name: '‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡πâ‡∏ô‡∏ñ‡∏∏‡∏á', description: '‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 12,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô' },
            '0002': { emoji: 'üíµ', name: '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å', description: '‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 14,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô' },
            '0003': { emoji: 'ü§ë', name: '‡∏ñ‡∏π‡∏Å‡∏´‡∏ß‡∏¢', description: '‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 20,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô' },
            '0004': { emoji: 'üè¶', name: '‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÉ‡∏´‡∏ç‡πà', description: '‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 40,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô' },
            '0005': { emoji: 'üé≤', name: '‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏ï‡πâ‡∏°‡∏ö‡∏∏‡∏ç', description: '‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 10,000-20,000' },
            '0006': { emoji: 'üé∞', name: '‡πÅ‡∏à‡πá‡∏Ñ‡∏û‡∏≠‡∏ï', description: '‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 25,000-50,000' },
            '0007': { emoji: 'üìà', name: '‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ó‡∏ö‡∏ï‡πâ‡∏ô', description: '‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 5% ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á' },
            '0008': { emoji: 'üöÄ', name: '‡∏û‡∏∏‡πà‡∏á‡∏ó‡∏∞‡∏¢‡∏≤‡∏ô', description: '‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 10% ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á' },
            '0009': { emoji: '‚ù§Ô∏è‚Äçü©π', name: '‡∏ä‡∏∏‡∏ö‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï', description: '‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏¥‡∏î‡∏•‡∏ö ‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏µ‡πà 15,000' },
            '0010': { emoji: 'üòÇ', name: '‡πÄ‡∏•‡∏Ç‡∏™‡∏ß‡∏¢', description: '‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 15,555 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô' },
            '0011': { emoji: '‚öñÔ∏è', name: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏õ‡∏•‡∏≠‡∏ö‡πÉ‡∏à', description: '‡∏•‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡∏≠‡∏¢‡∏π‡πà' },
            '0012': { emoji: 'ü™ô', name: '‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏±‡∏ô‡∏ú‡∏•', description: '‡∏£‡∏±‡∏ö‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ 1% ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ' },
            '0013': { emoji: 'üçÄ', name: '‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡∏™‡∏µ‡πà‡πÅ‡∏â‡∏Å', description: '‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 17,777 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô' },
            '0014': { emoji: 'üíé', name: '‡∏Ç‡∏∏‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå', description: '‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏Å‡πâ‡∏≠‡∏ô‡πÇ‡∏ï 50,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô' },
            '0015': { emoji: 'ü§ù', name: '‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏†‡∏≤‡∏û', description: '‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 15,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô' },
            '0016': { emoji: 'üîÑ', name: '‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏î‡∏∏‡∏•', description: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô' },
            '0017': { emoji: 'üïäÔ∏è', name: '‡∏™‡∏ô‡∏ò‡∏¥‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏™‡∏á‡∏ö‡∏®‡∏∂‡∏Å', description: '‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡∏î‡∏µ‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°' },
            '0018': { emoji: 'üë∫', name: '‡∏°‡∏∑‡∏≠‡πÑ‡∏ß', description: '‡∏Ç‡πÇ‡∏°‡∏¢ 20,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô' },
            '0019': { emoji: 'ü•∑', name: '‡∏õ‡∏•‡πâ‡∏ô‡∏™‡∏∞‡∏î‡∏°', description: '‡∏õ‡∏•‡πâ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏´‡∏ç‡πà 40,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô' },
            '0020': { emoji: '‚ùì', name: '‡∏•‡πâ‡∏ß‡∏á‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤', description: '‡∏™‡∏∏‡πà‡∏°‡∏Ç‡πÇ‡∏°‡∏¢ 10,000-20,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô' },
            '0021': { emoji: '‚ÄºÔ∏è', name: '‡∏ó‡∏∏‡∏ö‡∏Å‡∏£‡∏∞‡∏õ‡∏∏‡∏Å', description: '‡∏™‡∏∏‡πà‡∏°‡∏Ç‡πÇ‡∏°‡∏¢ 25,000-50,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô' },
            '0022': { emoji: 'üßõ', name: '‡∏î‡∏π‡∏î‡∏û‡∏•‡∏±‡∏á', description: '‡∏î‡∏π‡∏î‡∏û‡∏•‡∏±‡∏á 10% ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π' },
            '0023': { emoji: 'üí•', name: '‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏•‡πâ‡∏≤‡∏á', description: '‡∏ó‡∏≥‡∏•‡∏≤‡∏¢ 10% ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π' },
            '0024': { emoji: 'üí£', name: '‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î‡∏û‡∏•‡∏µ‡∏ä‡∏µ‡∏û', description: '‡∏ó‡∏≥‡∏•‡∏≤‡∏¢ 20% ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π' },
            '0025': { emoji: 'üé≠', name: '‡∏û‡∏•‡∏¥‡∏Å‡∏ä‡∏∞‡∏ï‡∏≤', description: '‡∏™‡∏•‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡∏°‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°' },
            '0026': { emoji: 'üìâ', name: '‡∏•‡πâ‡∏≤‡∏á‡∏ö‡∏≤‡∏á', description: '‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 25,000' },
            '0027': { emoji: 'üßê', name: '‡∏†‡∏≤‡∏©‡∏µ‡∏Ñ‡∏ô‡∏£‡∏ß‡∏¢', description: '‡πÄ‡∏Å‡πá‡∏ö‡∏†‡∏≤‡∏©‡∏µ‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏≥‡∏≠‡∏¢‡∏π‡πà' },
            '0028': { emoji: 'üíß', name: '‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡∏£‡∏±‡πà‡∏ß', description: '‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π‡∏£‡∏±‡πà‡∏ß‡πÑ‡∏´‡∏• 2 ‡∏ô‡∏≤‡∏ó‡∏µ' },
            '0029': { emoji: '‚òÑÔ∏è', name: '‡∏≠‡∏∏‡∏Å‡∏Å‡∏≤‡∏ö‡∏≤‡∏ï', description: '‡∏®‡∏±‡∏ï‡∏£‡∏π‡πÄ‡∏™‡∏µ‡∏¢ 35,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô' },
            '0030': { emoji: 'ü¶†', name: '‡πÇ‡∏£‡∏Ñ‡∏£‡∏∞‡∏ö‡∏≤‡∏î', description: '‡∏®‡∏±‡∏ï‡∏£‡∏π‡πÄ‡∏™‡∏µ‡∏¢‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÅ‡∏•‡∏∞‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á' },
            '0031': { emoji: '‚úçÔ∏è', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô', description: '‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô' },
            '0032': { emoji: 'üí∏', name: '‡∏Ñ‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠', description: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°‡∏ñ‡∏π‡∏Å‡∏´‡∏≤‡∏£‡∏™‡∏≠‡∏á' },
            '0033': { emoji: 'üßæ', name: '‡∏™‡∏£‡∏£‡∏û‡∏≤‡∏Å‡∏£‡∏•‡∏á', description: '‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏™‡∏µ‡∏¢ 30% ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô' },
            '0034': { emoji: 'üîÆ', name: '‡πÄ‡∏î‡∏à‡∏≤‡∏ß‡∏π', description: '‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ö‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Å‡∏¥‡∏î‡∏ã‡πâ‡∏≥' },
            '0035': { emoji: 'üèñÔ∏è', name: '‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î', description: '‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î 1 ‡∏ô‡∏≤‡∏ó‡∏µ' },
            '0036': { emoji: 'üé≤', name: '‡∏ß‡∏±‡∏î‡∏î‡∏ß‡∏á', description: '‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô 30,000 ‡∏•‡∏∏‡πâ‡∏ô‡∏£‡∏±‡∏ö 60,000' },
            '0037': { emoji: 'üé≠', name: '‡∏™‡∏ß‡∏°‡∏£‡∏≠‡∏¢', description: '‡∏Ç‡πÇ‡∏°‡∏¢‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡∏®‡∏±‡∏ï‡∏£‡∏π‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 2 ‡∏ô‡∏≤‡∏ó‡∏µ' },
            '0038': { emoji: '‚ö´', name: '‡∏´‡∏•‡∏∏‡∏°‡∏î‡∏≥', description: '‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡πÑ‡∏£‡πâ‡∏ú‡∏•' },
            '0039': { emoji: 'üîí', name: '‡πÑ‡∏ß‡∏£‡∏±‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡πà‡∏≤‡πÑ‡∏ñ‡πà', description: '‡∏•‡πá‡∏≠‡∏Ñ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡∏®‡∏±‡∏ï‡∏£‡∏π' },
            '0040': { emoji: 'üéÅ', name: '‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏Å‡∏ß‡∏ô‡πÜ', description: '‡πÄ‡∏£‡∏≤‡πÄ‡∏™‡∏µ‡∏¢ 10,000 ‡∏®‡∏±‡∏ï‡∏£‡∏π‡πÑ‡∏î‡πâ 5,000' },
            '0041': { emoji: 'ü§∏', name: '‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á!', description: '‡∏ó‡∏µ‡∏°‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡∏ï‡∏ö' },
            '0042': { emoji: 'üí™', name: '‡πÄ‡∏ö‡πà‡∏á‡∏Å‡∏•‡πâ‡∏≤‡∏°!', description: '‡∏ó‡∏µ‡∏°‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏±‡∏ô‡∏û‡∏∑‡πâ‡∏ô' },
            '0043': { emoji: 'üßò', name: '‡∏ó‡∏£‡∏á‡∏ï‡∏±‡∏ß!', description: '‡∏ó‡∏µ‡∏°‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏û‡∏•‡∏á‡∏Ñ‡πå' },
            '0044': { emoji: 'üòµ‚Äçüí´', name: '‡πÇ‡∏•‡∏Å‡∏´‡∏°‡∏∏‡∏ô!', description: '‡∏ó‡∏µ‡∏°‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏±‡πà‡∏ô‡∏à‡∏¥‡πâ‡∏á‡∏´‡∏£‡∏µ‡∏î' },
            '0045': { emoji: 'üï∫', name: '‡πÅ‡∏î‡∏ô‡∏ã‡πå!', description: '‡∏ó‡∏µ‡∏°‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏ó‡πà‡∏≤‡∏ü‡∏£‡∏µ‡∏™‡πÑ‡∏ï‡∏•‡πå' },
            // Legendary Cards
            '0046': { emoji: 'üåü', name: '‡∏¢‡∏∏‡∏Ñ‡∏ó‡∏≠‡∏á', description: '‡∏ó‡∏µ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 500,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!' },
            '0047': { emoji: 'üìâ', name: '‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à', description: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏´‡∏≤‡∏£ 2 ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!' },
            '0048': { emoji: 'üìú', name: '‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏µ‡πâ', description: '‡∏´‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÇ‡∏≠‡∏ô‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏°‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°!' },
            '0049': { emoji: 'üëë', name: '‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏ä‡∏≤', description: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡∏≠‡∏¢‡∏π‡πà +1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!' },
            '0050': { emoji: '‚úä', name: '‡∏õ‡∏è‡∏¥‡∏ß‡∏±‡∏ï‡∏¥', description: '‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏Ç‡πÇ‡∏°‡∏¢ 50% ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏≥!' },
            '0051': { emoji: 'üí•', name: '‡πÄ‡∏Å‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå', description: '‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 0!' },
            '0052': { emoji: 'üôè', name: '‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå‡πÄ‡∏°‡∏ï‡∏ï‡∏≤', description: '‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 1,000,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!' },
            '0053': { emoji: ' Pandora\'s Box', name: '‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏û‡∏ô‡πÇ‡∏î‡∏£‡πà‡∏≤', description: '‡∏™‡∏∏‡πà‡∏°‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ô‡∏ï‡∏≥‡∏ô‡∏≤‡∏ô‡πÉ‡∏™‡πà‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ó‡∏µ‡∏°!' },
            '0054': { emoji: 'üëØ', name: '‡∏†‡∏≤‡∏û‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô', description: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡∏°‡πÄ‡∏£‡∏≤!' },
            '0055': { emoji: '‚òÑÔ∏è', name: '‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡πÇ‡∏•‡∏Å', description: '‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ó‡∏µ‡∏°‡πÄ‡∏™‡∏µ‡∏¢ 50% ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡πÅ‡∏ï‡πà‡∏ó‡∏µ‡∏°‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å 100,000!' },
        };

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        function playSound(type, duration = 1) {
            if (!audioCtx) return;
            const now = audioCtx.currentTime;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            switch(type) {
                case 'scan': oscillator.type = 'sine'; oscillator.frequency.setValueAtTime(880, now); gainNode.gain.setValueAtTime(0.5, now); gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.2); break;
                case 'positive': oscillator.type = 'triangle'; oscillator.frequency.setValueAtTime(523.25, now); oscillator.frequency.linearRampToValueAtTime(1046.50, now + 0.1); gainNode.gain.setValueAtTime(0.3, now); gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.2); break;
                case 'negative': oscillator.type = 'sawtooth'; oscillator.frequency.setValueAtTime(440, now); oscillator.frequency.linearRampToValueAtTime(220, now + 0.2); gainNode.gain.setValueAtTime(0.4, now); gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.3); break;
                case 'gamble_reel':
                    oscillator.type = 'square';
                    gainNode.gain.setValueAtTime(0.1, now);
                    const notes = [261, 293, 329, 349, 392, 440, 493, 523];
                    for(let i = 0; i < duration * 10; i++) {
                        oscillator.frequency.setValueAtTime(notes[Math.floor(Math.random() * notes.length)], now + i * 0.1);
                    }
                    gainNode.gain.exponentialRampToValueAtTime(0.0001, now + duration);
                    break;
                case 'end': oscillator.type = 'sawtooth'; gainNode.gain.setValueAtTime(0.5, now); oscillator.frequency.setValueAtTime(880, now); oscillator.frequency.setValueAtTime(440, now + 0.1); oscillator.frequency.setValueAtTime(880, now + 0.2); gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.5); break;
            }
            oscillator.start(now);
            oscillator.stop(now + duration);
        }

        function updateLeaderIndicator() {
            elements.team1.leaderIndicator.innerHTML = '';
            elements.team2.leaderIndicator.innerHTML = '';
            if (teams[1].score > teams[2].score) {
                elements.team1.leaderIndicator.innerHTML = '<i class="fa-solid fa-crown animate-bounce"></i>';
            } else if (teams[2].score > teams[1].score) {
                elements.team2.leaderIndicator.innerHTML = '<i class="fa-solid fa-crown animate-bounce"></i>';
            }
        }

        function updateBankUI() {
            elements.bankScore.textContent = bankScore.toLocaleString();
        }

        function updateTeamUI(teamId) {
            const teamData = teams[teamId];
            const teamElements = elements[`team${teamId}`];
            teamElements.name.value = teamData.name;
            teamElements.name.style.color = teamData.color;
            teamElements.color.value = teamData.color;
            teamElements.score.innerText = teamData.score.toLocaleString();
            teamElements.panel.style.borderColor = teamData.color;
            teamElements.panel.style.boxShadow = `0 0 20px ${teamData.color}40`;
            
            teamElements.score.style.setProperty('--team-color', teamData.color);
            if (!teamElements.score.classList.contains('score-blinking')) {
                teamElements.score.classList.add('score-blinking');
            }

            if(teamData.debt) {
                teamElements.debtDisplay.textContent = `‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô: ${teamData.debt.amount.toLocaleString()}`;
                teamElements.loanContainer.innerHTML = `<button class="w-full py-2 text-sm font-bold rounded-lg bg-orange-500 hover:bg-orange-600 transition text-gray-900" onclick="handleLoan(${teamId})"><i class="fa-solid fa-cash-register"></i> ‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ</button>`;
            } else {
                teamElements.debtDisplay.textContent = '';
                teamElements.loanContainer.innerHTML = `<div class="flex gap-1"><input type="number" id="team${teamId}-loan-amount" class="manual-score-input w-2/3" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"><button class="w-1/3 py-2 text-sm font-bold rounded-lg bg-green-500 hover:bg-green-600 transition text-gray-900" onclick="handleLoan(${teamId})"><i class="fa-solid fa-hand-holding-dollar"></i></button></div>`;
            }
            updateLeaderIndicator();
        }

        function renderBattleLog() {
            elements.feed.innerHTML = '';
            feedEvents.slice(0, 10).forEach(event => {
                const teamData = teams[event.teamId] || { color: '#ffffff', name: 'System' };
                const li = document.createElement('li');
                li.className = 'flex items-start space-x-3 text-sm';
                li.innerHTML = `<i class="fa-solid fa-star mt-1" style="color: ${teamData.color};"></i><p class="text-gray-300">${event.teamId ? `<strong style="color: ${teamData.color};">${teamData.name}</strong>` : ''} ${event.text}</p>`;
                elements.feed.appendChild(li);
            });
        }

        function addLog(teamId, text) { feedEvents.unshift({ teamId, text }); if (feedEvents.length > 20) feedEvents.pop(); renderBattleLog(); }
        
        function performCardAction(teamId, barcodeResult, isDejaVu = false) {
            // For Pandora's Box, teamId can be null initially.
            if (teamId !== null) {
                let opponentId = teamId === 1 ? 2 : 1;
            }
            let logText = '';
            let soundType = 'positive';
            let amount = 0;
            
            const isAttackCard = barcodeResult > '0017'; // Simple check for attack/chaos cards
            if (currentEvent === 'BLOOD_MOON' && isAttackCard) {
                logText += '[BLOOD MOON!] ';
            }

            // Define opponentId here, it's needed in many cases
            let opponentId = teamId === 1 ? 2 : 1;

            switch (barcodeResult) {
                case '0001': teams[teamId].score += 12000; bankScore -= 12000; logText = `‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 12,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`; break;
                case '0002': teams[teamId].score += 14000; bankScore -= 14000; logText = `‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 14,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`; break;
                case '0003': teams[teamId].score += 20000; bankScore -= 20000; logText = `‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 20,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`; break;
                case '0004': teams[teamId].score += 40000; bankScore -= 40000; logText = `‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÉ‡∏´‡∏ç‡πà 40,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`; break;
                case '0005': const r1 = Math.floor(Math.random() * 10001) + 10000; teams[teamId].score += r1; bankScore -= r1; logText = `‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏î‡πâ ${r1.toLocaleString()} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`; break;
                case '0006': const r2 = Math.floor(Math.random() * 25001) + 25000; teams[teamId].score += r2; bankScore -= r2; logText = `‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏î‡πâ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÉ‡∏´‡∏ç‡πà ${r2.toLocaleString()} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`; break;
                case '0007': const g1 = Math.floor(teams[teamId].score * 0.05); teams[teamId].score += g1; bankScore -= g1; logText = `‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 5% ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ${g1.toLocaleString()} ‡πÅ‡∏ï‡πâ‡∏°`; break;
                case '0008': const g2 = Math.floor(teams[teamId].score * 0.10); teams[teamId].score += g2; bankScore -= g2; logText = `‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 10% ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ${g2.toLocaleString()} ‡πÅ‡∏ï‡πâ‡∏°`; break;
                case '0009': if (teams[teamId].score <= 0) { teams[teamId].score = 15000; bankScore -= 15000; logText = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏µ‡πà 15,000!`; } else { logText = `‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ä‡∏∏‡∏ö‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏∞‡πÑ‡∏£‡∏Ç‡∏∂‡πâ‡∏ô`; soundType = 'negative';} break;
                case '0010': teams[teamId].score += 15555; bankScore -= 15555; logText = `‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏Ç‡∏™‡∏ß‡∏¢ 15,555 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`; break;
                case '0011': if (teams[teamId].score < teams[opponentId].score) { const diff = Math.floor((teams[opponentId].score - teams[teamId].score) / 2); teams[teamId].score += diff; bankScore -= diff; logText = `‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏õ‡∏•‡∏≠‡∏ö‡πÉ‡∏à ${diff.toLocaleString()} ‡πÅ‡∏ï‡πâ‡∏°!`; } else { logText = `‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏õ‡∏•‡∏≠‡∏ö‡πÉ‡∏à ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏≥‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß`; soundType = 'negative'; } break;
                case '0012': const interest = Math.floor(teams[teamId].score * 0.01); teams[teamId].score += interest; bankScore -= interest; logText = `‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ 1% ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ${interest.toLocaleString()} ‡πÅ‡∏ï‡πâ‡∏°`; break;
                case '0013': teams[teamId].score += 17777; bankScore -= 17777; logText = `‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏Ç‡∏ô‡∏≥‡πÇ‡∏ä‡∏Ñ 17,777 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`; break;
                case '0014': teams[teamId].score += 50000; bankScore -= 50000; logText = `‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏Å‡πâ‡∏≠‡∏ô‡πÇ‡∏ï 50,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`; break;
                case '0015': teams[1].score += 15000; teams[2].score += 15000; bankScore -= 30000; teamId = null; logText = `‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 15,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`; break;
                case '0016': const currentTotal = teams[1].score + teams[2].score; const avg = Math.floor(currentTotal / 2); bankScore += currentTotal - (avg*2); teams[1].score = avg; teams[2].score = avg; teamId = null; logText = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà ${avg.toLocaleString()}!`; soundType = 'negative'; break;
                case '0017': teamId = null; logText = `‡∏™‡∏ô‡∏ò‡∏¥‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏™‡∏á‡∏ö‡∏®‡∏∂‡∏Å!`; break;
                case '0018': amount = currentEvent === 'BLOOD_MOON' ? 30000 : 20000; teams[teamId].score += amount; teams[opponentId].score -= amount; logText += `‡∏Ç‡πÇ‡∏°‡∏¢ ${amount.toLocaleString()} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏° ${teams[opponentId].name}!`; soundType = 'negative'; break;
                case '0019': amount = currentEvent === 'BLOOD_MOON' ? 60000 : 40000; teams[teamId].score += amount; teams[opponentId].score -= amount; logText += `‡∏õ‡∏•‡πâ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏´‡∏ç‡πà! ‡∏Ç‡πÇ‡∏°‡∏¢ ${amount.toLocaleString()} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏° ${teams[opponentId].name}!`; soundType = 'negative'; break;
                case '0020': amount = Math.floor(Math.random() * 10001) + 10000; if(currentEvent === 'BLOOD_MOON') amount = Math.floor(amount*1.5); teams[teamId].score += amount; teams[opponentId].score -= amount; logText += `‡∏™‡∏∏‡πà‡∏°‡∏Ç‡πÇ‡∏°‡∏¢ ${amount.toLocaleString()} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏° ${teams[opponentId].name}!`; soundType = 'negative'; break;
                case '0021': amount = Math.floor(Math.random() * 25001) + 25000; if(currentEvent === 'BLOOD_MOON') amount = Math.floor(amount*1.5); teams[teamId].score += amount; teams[opponentId].score -= amount; logText += `‡∏™‡∏∏‡πà‡∏°‡∏Ç‡πÇ‡∏°‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏´‡∏ç‡πà ${amount.toLocaleString()} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏° ${teams[opponentId].name}!`; soundType = 'negative'; break;
                case '0022': amount = Math.floor(teams[opponentId].score * (currentEvent === 'BLOOD_MOON' ? 0.15 : 0.10)); teams[teamId].score += amount; teams[opponentId].score -= amount; logText += `‡∏î‡∏π‡∏î‡∏û‡∏•‡∏±‡∏á (${amount.toLocaleString()} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô) ‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏° ${teams[opponentId].name}!`; soundType = 'negative'; break;
                case '0023': amount = Math.floor(teams[opponentId].score * (currentEvent === 'BLOOD_MOON' ? 0.15 : 0.10)); teams[opponentId].score -= amount; bankScore += amount; logText += `‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (${amount.toLocaleString()} ‡πÅ‡∏ï‡πâ‡∏°) ‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏° ${teams[opponentId].name}!`; soundType = 'negative'; break;
                case '0024': amount = Math.floor(teams[opponentId].score * (currentEvent === 'BLOOD_MOON' ? 0.30 : 0.20)); teams[opponentId].score -= amount; bankScore += amount; logText += `‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (${amount.toLocaleString()} ‡πÅ‡∏ï‡πâ‡∏°) ‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏° ${teams[opponentId].name}!`; soundType = 'negative'; break;
                case '0025': [teams[teamId].score, teams[opponentId].score] = [teams[opponentId].score, teams[teamId].score]; logText = `‡∏û‡∏•‡∏¥‡∏Å‡∏ä‡∏∞‡∏ï‡∏≤! ‡∏™‡∏•‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡∏° ${teams[opponentId].name}!`; soundType = 'negative'; break;
                case '0026': if (teams[opponentId].score > 25000) { bankScore += teams[opponentId].score - 25000; teams[opponentId].score = 25000; logText = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏° ${teams[opponentId].name} ‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà 25,000!`; soundType = 'negative';} else { logText = `‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`; } break;
                case '0027': if (teams[opponentId].score > teams[teamId].score) { amount = Math.floor((teams[opponentId].score - teams[teamId].score) * (currentEvent === 'BLOOD_MOON' ? 0.225 : 0.15)); teams[teamId].score += amount; teams[opponentId].score -= amount; logText += `‡πÄ‡∏Å‡πá‡∏ö‡∏†‡∏≤‡∏©‡∏µ‡∏Ñ‡∏ô‡∏£‡∏ß‡∏¢! ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ${amount.toLocaleString()} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏° ${teams[opponentId].name}!`; } else { logText = `‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏Å‡πá‡∏ö‡∏†‡∏≤‡∏©‡∏µ ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤`; soundType = 'negative'; } break;
                case '0028': logText = `‡∏ó‡∏µ‡∏° ${teams[opponentId].name} ‡πÇ‡∏î‡∏ô‡∏Ñ‡∏≥‡∏™‡∏≤‡∏õ‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡∏£‡∏±‡πà‡∏ß!`; soundType = 'negative'; break; // Note: Actual effect not implemented
                case '0029': amount = currentEvent === 'BLOOD_MOON' ? 52500 : 35000; teams[opponentId].score -= amount; bankScore += amount; logText += `‡∏ó‡∏¥‡πâ‡∏á‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô! ‡∏ó‡∏µ‡∏° ${teams[opponentId].name} ‡πÄ‡∏™‡∏µ‡∏¢ ${amount.toLocaleString()} ‡πÅ‡∏ï‡πâ‡∏°!`; soundType = 'negative'; break;
                case '0030': amount = currentEvent === 'BLOOD_MOON' ? 15000 : 10000; teams[opponentId].score -= amount; bankScore += amount; logText += `‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÇ‡∏£‡∏Ñ‡∏£‡∏∞‡∏ö‡∏≤‡∏î! ‡∏ó‡∏µ‡∏° ${teams[opponentId].name} ‡πÄ‡∏™‡∏µ‡∏¢ ${amount.toLocaleString()} ‡πÅ‡∏ï‡πâ‡∏°!`; soundType = 'negative'; break; // Note: Continuous effect not implemented
                case '0031': const s1 = teams[1].score; const s2 = teams[2].score; const lastTwo1 = s1 % 100; const lastTwo2 = s2 % 100; teams[1].score = s1 - lastTwo1 + lastTwo2; teams[2].score = s2 - lastTwo2 + lastTwo1; teamId = null; logText = `‡πÄ‡∏î‡πá‡∏Å‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏µ‡∏¢‡πå‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ú‡∏¥‡∏î! ‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ó‡∏µ‡∏°‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏±‡∏ô!`; soundType = 'negative'; break;
                case '0032':
                    const originalScore1 = teams[1].score;
                    const originalScore2 = teams[2].score;
                    teams[1].score = Math.floor(originalScore1 / 2);
                    teams[2].score = Math.floor(originalScore2 / 2);
                    const totalLoss = (originalScore1 - teams[1].score) + (originalScore2 - teams[2].score);
                    bankScore += totalLoss;
                    teamId = null;
                    logText = `‡∏Ñ‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°‡∏ñ‡∏π‡∏Å‡∏´‡∏≤‡∏£‡∏™‡∏≠‡∏á!`;
                    soundType = 'negative';
                    break;
                case '0033': const leaderId = teams[1].score > teams[2].score ? 1 : 2; const loserId = leaderId === 1 ? 2 : 1; if(teams[1].score !== teams[2].score) { amount = Math.floor(teams[leaderId].score * (currentEvent === 'BLOOD_MOON' ? 0.45 : 0.30)); teams[leaderId].score -= amount; bankScore += amount; logText += `‡∏™‡∏£‡∏£‡∏û‡∏≤‡∏Å‡∏£‡∏•‡∏á! ‡∏ó‡∏µ‡∏°‡∏ú‡∏π‡πâ‡∏ô‡∏≥ (${teams[leaderId].name}) ‡πÇ‡∏î‡∏ô‡∏´‡∏±‡∏Å ${amount.toLocaleString()} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`; teamId = loserId; soundType = 'negative'; } else { logText = `‡∏™‡∏£‡∏£‡∏û‡∏≤‡∏Å‡∏£‡∏°‡∏≤ ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô ‡πÄ‡∏•‡∏¢‡∏£‡∏≠‡∏î‡∏ï‡∏±‡∏ß‡πÑ‡∏õ!`; teamId = null; } break;
                case '0034': if (lastCardAction.barcode) { addLog(null, `‡πÄ‡∏î‡∏à‡∏≤‡∏ß‡∏π! ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ö‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á!`); performCardAction(lastCardAction.teamId, lastCardAction.barcode, true); return; } else { logText = `‡πÉ‡∏ä‡πâ‡πÄ‡∏î‡∏à‡∏≤‡∏ß‡∏π ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤...`; teamId = null; soundType = 'negative';} break;
                case '0035': teamId = null; logText = `‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏±‡∏Å‡∏Ç‡∏±‡∏ï‡∏§‡∏Å‡∏©‡πå!`; soundType = 'negative'; break; // Note: Actual effect not implemented
                case '0036': if (teams[teamId].score >= 30000) { teams[teamId].score -= 30000; bankScore += 30000; if (Math.random() < 0.5) { teams[teamId].score += 60000; bankScore -= 60000; logText = `‡∏ß‡∏±‡∏î‡∏î‡∏ß‡∏á... ‡πÅ‡∏•‡∏∞‡∏ä‡∏ô‡∏∞! ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 60,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`; } else { logText = `‡∏ß‡∏±‡∏î‡∏î‡∏ß‡∏á... ‡πÅ‡∏•‡∏∞‡πÅ‡∏û‡πâ! ‡πÄ‡∏™‡∏µ‡∏¢ 30,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏õ‡∏ü‡∏£‡∏µ‡πÜ!`; soundType = 'negative'; } } else { logText = `‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ß‡∏±‡∏î‡∏î‡∏ß‡∏á ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠!`; soundType = 'negative'; } break;
                case '0037': logText = `‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô "‡∏™‡∏ß‡∏°‡∏£‡∏≠‡∏¢"!`; break; // Note: Actual effect not implemented
                case '0038': logText = `‡πÄ‡∏õ‡∏¥‡∏î "‡∏´‡∏•‡∏∏‡∏°‡∏î‡∏≥"!`; break; // Note: Actual effect not implemented
                case '0039': logText = `‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÑ‡∏ß‡∏£‡∏±‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡πà‡∏≤‡πÑ‡∏ñ‡πà!`; soundType = 'negative'; break; // Note: Actual effect not implemented
                case '0040': teams[teamId].score -= 10000; teams[opponentId].score += 5000; bankScore += 5000; logText = `‡∏°‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏Å‡∏ß‡∏ô‡πÜ! ‡∏ó‡∏µ‡∏°‡πÄ‡∏£‡∏≤‡πÄ‡∏™‡∏µ‡∏¢ 10,000 ‡πÅ‡∏ï‡πà‡∏ó‡∏µ‡∏° ${teams[opponentId].name} ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 5,000!`; soundType = 'negative'; break;
                case '0041': case '0042': case '0043': case '0044': case '0045':
                    const reps = Math.floor(Math.random() * 21) + 10;
                    let unit = '‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
                    if (barcodeResult === '0043') unit = '‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ';
                    if (barcodeResult === '0044') unit = '‡∏£‡∏≠‡∏ö';
                    if (barcodeResult === '0045') unit = '‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ';
                    logText = `‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏° ${teams[opponentId].name} ${cardDatabase[barcodeResult].description.replace('‡∏ó‡∏µ‡∏°‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á', '')} ${reps} ${unit}!`;
                    soundType = 'negative';
                    break;
                // --- LEGENDARY CARDS ---
                case '0046': teams[teamId].score += 500000; bankScore -= 500000; logText = `‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏¢‡∏∏‡∏Ñ‡∏ó‡∏≠‡∏á! ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 500,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`; break;
                case '0047':
                    const originalOpponentScore = teams[opponentId].score;
                    teams[opponentId].score = Math.floor(originalOpponentScore / 2);
                    const loss = originalOpponentScore - teams[opponentId].score;
                    bankScore += loss;
                    logText = `‡πÄ‡∏Å‡∏¥‡∏î‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏° ${teams[opponentId].name} ‡∏ñ‡∏π‡∏Å‡∏´‡∏≤‡∏£‡∏™‡∏≠‡∏á!`;
                    soundType = 'negative';
                    break;
                case '0048': if(teams[teamId].debt) { const debtAmount = teams[teamId].debt.amount; clearInterval(teams[teamId].debt.interval); teams[teamId].debt = null; teams[opponentId].debt = { principal: debtAmount, amount: debtAmount, interval: setInterval(() => { const interest = Math.floor(teams[opponentId].debt.principal * 0.20); teams[opponentId].debt.amount += interest; addLog(opponentId, `‡πÇ‡∏î‡∏ô‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ ${interest.toLocaleString()}! ‡∏¢‡∏≠‡∏î‡∏´‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô ${teams[opponentId].debt.amount.toLocaleString()}`); updateTeamUI(opponentId); }, 600000)}; logText = `‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡∏π‡∏Å‡πÇ‡∏≠‡∏ô‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏° ${teams[opponentId].name}!`; } else { logText = `‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏µ‡πâ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô!`; soundType = 'negative'; } break;
                case '0049': if (teams[teamId].score < teams[opponentId].score) { amount = (teams[opponentId].score + 1) - teams[teamId].score; teams[teamId].score += amount; bankScore -= amount; logText = `‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≤‡∏ä‡∏≤! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ã‡∏á ${teams[opponentId].name}!`; } else { logText = `‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏ä‡∏≤ ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏≥‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß!`; soundType = 'negative'; } break;
                case '0050': const leader = teams[1].score > teams[2].score ? 1 : 2; const trailer = leader === 1 ? 2 : 1; if(teams[1].score !== teams[2].score && teamId === trailer) { amount = Math.floor(teams[leader].score * 0.5); teams[trailer].score += amount; teams[leader].score -= amount; logText = `‡∏õ‡∏è‡∏¥‡∏ß‡∏±‡∏ï‡∏¥! ‡∏ó‡∏µ‡∏° ${teams[trailer].name} ‡∏Ç‡πÇ‡∏°‡∏¢ 50% ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏° ${teams[leader].name}!`; } else { logText = `‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏õ‡∏è‡∏¥‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`; soundType = 'negative'; } break;
                case '0051': bankScore += teams[opponentId].score; teams[opponentId].score = 0; logText = `‡πÄ‡∏Å‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏° ${teams[opponentId].name} ‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏õ‡πá‡∏ô 0!`; soundType = 'negative'; break;
                case '0052': teams[teamId].score += 1000000; bankScore -= 1000000; logText = `‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå‡πÄ‡∏°‡∏ï‡∏ï‡∏≤! ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 1,000,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`; break;
                case '0053':
                    teamId = null; // System event
                    logText = `‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏û‡∏ô‡πÇ‡∏î‡∏£‡πà‡∏≤! ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏Å‡∏•‡∏≤‡∏´‡∏•‡∏ö‡∏±‡∏á‡πÄ‡∏Å‡∏¥‡∏î!`;
                    soundType = 'negative';
                    // This card's actions are handled outside the main flow to affect both teams
                    // We add the initial log here, then trigger the separate actions.
                    setTimeout(() => {
                        const legendaryCards = Object.keys(cardDatabase).filter(k => k >= '0046' && k <= '0055');
                        let card1 = legendaryCards[Math.floor(Math.random() * legendaryCards.length)];
                        let card2 = legendaryCards[Math.floor(Math.random() * legendaryCards.length)];
                        
                        addLog(null, `‡∏ó‡∏µ‡∏° ${teams[1].name} ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏à‡∏≤‡∏Å: ${cardDatabase[card1].name}!`);
                        performCardAction(1, card1);
                        
                        setTimeout(() => {
                            addLog(null, `‡∏ó‡∏µ‡∏° ${teams[2].name} ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏à‡∏≤‡∏Å: ${cardDatabase[card2].name}!`);
                            performCardAction(2, card2);
                        }, 2000); // Stagger the effects for readability in the log
                    }, 1000);
                    // We must break here to avoid the default log/UI update at the end of the function
                    // because the actions are delayed.
                    playSound(soundType);
                    addLog(teamId, logText);
                    if (!isDejaVu) {
                       lastCardAction = { teamId, barcode: barcodeResult };
                    }
                    return; // Exit function early
                case '0054': amount = teams[teamId].score - teams[opponentId].score; bankScore -= amount; teams[opponentId].score = teams[teamId].score; logText = `‡∏†‡∏≤‡∏û‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏° ${teams[opponentId].name} ‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡∏°‡πÄ‡∏£‡∏≤!`; soundType = 'negative'; break;
                case '0055':
                    const lossTeam1 = Math.floor(teams[1].score * 0.5);
                    const lossTeam2 = Math.floor(teams[2].score * 0.5);
                    teams[1].score -= lossTeam1;
                    teams[2].score -= lossTeam2;
                    bankScore += lossTeam1 + lossTeam2;
                    
                    teams[opponentId].score -= 100000;
                    bankScore += 100000;

                    logText = `‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡πÇ‡∏•‡∏Å! ‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°‡πÄ‡∏™‡∏µ‡∏¢ 50% ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡∏° ${teams[opponentId].name} ‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å 100,000!`;
                    soundType = 'negative';
                    break;
                default: logText = `‡∏™‡πÅ‡∏Å‡∏ô QR Code "${barcodeResult}" ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ Action ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô`; soundType = 'negative'; break;
            }
            
            playSound(soundType);
            addLog(teamId, logText);
            if (!isDejaVu) {
                lastCardAction = { teamId, barcode: barcodeResult };
            }

            // Update UI for all teams if it was a global event
            if (teamId === null) {
                updateTeamUI(1);
                updateTeamUI(2);
            } else {
                updateTeamUI(teamId);
                updateTeamUI(opponentId);
            }
            updateBankUI();
        }

        function showCardInfo(barcode) {
            const card = cardDatabase[barcode];
            if (card) {
                let description = card.description;
                if(barcode >= '0041' && barcode <= '0045') {
                    const reps = Math.floor(Math.random() * 21) + 10;
                    let unit = '‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
                    if (barcode === '0043') unit = '‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ';
                    if (barcode === '0044') unit = '‡∏£‡∏≠‡∏ö';
                    if (barcode === '0045') unit = '‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ';
                    description = `${card.description} ${reps} ${unit}!`;
                }
                showCustomAlert(card.name, description, card.emoji);
                setTimeout(() => {
                    closeCustomAlert();
                    // Pandora's box is a special case and is handled inside performCardAction directly
                    if (barcode === '0053') {
                        performCardAction(activeTeam, barcode);
                    } else {
                        performCardAction(activeTeam, barcode);
                    }
                }, 4000);
            } else {
                performCardAction(activeTeam, barcode); // Fallback for unknown cards
            }
        }

        function handleRfidInput(event, teamId) {
            if (event.key === 'Enter') {
                initAudio();
                const rfidValue = event.target.value;
                if (rfidValue) {
                    playSound('scan');
                    activeTeam = teamId;
                    showCardInfo(rfidValue);
                    event.target.value = '';
                }
            }
        }

        function showCustomAlert(title, message, icon) {
            elements.alertTitle.textContent = title;
            elements.alertMessage.textContent = message;
            elements.alertIcon.innerHTML = `<div class="text-5xl">${icon}</div>`;
            elements.alertButtons.innerHTML = `<button id="close-alert-button" class="bg-blue-600 text-white font-bold py-2 px-8 rounded-lg hover:bg-blue-700 transition">OK</button>`;
            document.getElementById('close-alert-button').onclick = closeCustomAlert;
            elements.alertModal.classList.remove('opacity-0', 'pointer-events-none');
        }

        function showCustomConfirm(title, message, icon, onConfirm) {
             elements.alertTitle.textContent = title;
            elements.alertMessage.textContent = message;
            elements.alertIcon.innerHTML = `<div class="text-5xl">${icon}</div>`;
            elements.alertButtons.innerHTML = `
                <button id="confirm-yes" class="bg-green-600 text-white font-bold py-2 px-8 rounded-lg hover:bg-green-700 transition">Yes</button>
                <button id="confirm-no" class="bg-red-600 text-white font-bold py-2 px-8 rounded-lg hover:bg-red-700 transition">No</button>
            `;
            document.getElementById('confirm-yes').onclick = () => {
                onConfirm();
                closeCustomAlert();
            };
            document.getElementById('confirm-no').onclick = closeCustomAlert;
            elements.alertModal.classList.remove('opacity-0', 'pointer-events-none');
        }
        
        function closeCustomAlert() {
            elements.alertModal.classList.add('opacity-0', 'pointer-events-none');
        }

        function handleManualScore(event, teamId) {
            if (event.key === 'Enter') {
                initAudio();
                const inputElement = event.target;
                const value = parseInt(inputElement.value, 10);
                if (!isNaN(value)) {
                    teams[teamId].score += value;
                    bankScore -= value;
                    updateBankUI();
                    const actionText = value >= 0 ? `‡πÄ‡∏û‡∏¥‡πà‡∏°` : `‡∏•‡∏î`;
                    addLog(teamId, `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ñ‡∏π‡∏Å${actionText}‡πÇ‡∏î‡∏¢‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô ${Math.abs(value).toLocaleString()} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`);
                    playSound(value >= 0 ? 'positive' : 'negative');
                    updateTeamUI(teamId);
                    inputElement.value = '';
                }
            }
        }
        
        function getGamblePrize() {
            const rand = Math.random();
            if (rand < 0.4) { // 40%
                return Math.floor(Math.random() * 9001); // 0 - 9000
            } else if (rand < 0.7) { // 30%
                return Math.floor(Math.random() * (300000 - 9001 + 1)) + 9001; // 9001 - 300000
            } else if (rand < 0.9) { // 20%
                return Math.floor(Math.random() * (700000 - 300001 + 1)) + 300001; // 300001 - 700000
            } else { // 10%
                return Math.floor(Math.random() * (1000000 - 700001 + 1)) + 700001; // 700001 - 1000000
            }
        }

        function handleGamble(teamId) {
            initAudio();
            const betAmount = 10000;
            const teamData = teams[teamId];

            if (teamData.score < betAmount) {
                addLog(teamId, `‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏à‡∏∞‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠! (‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${betAmount.toLocaleString()})`);
                playSound('negative');
                return;
            }

            teamData.score -= betAmount;
            bankScore += betAmount;
            updateBankUI();
            updateTeamUI(teamId);
            
            elements.gambleModal.classList.remove('opacity-0', 'pointer-events-none');
            elements.gambleResult.classList.add('hidden');
            
            playSound('gamble_reel', 5);
            const reelInterval = setInterval(() => {
                const randomDisplay = Math.floor(Math.random() * 1000000);
                elements.gambleReel.textContent = randomDisplay.toString().padStart(7, '0');
            }, 50);

            setTimeout(() => {
                clearInterval(reelInterval);
                const prize = getGamblePrize();
                teamData.score += prize;
                bankScore -= prize;
                
                elements.gambleReel.textContent = prize.toLocaleString();
                
                let resultMessage = '';
                if (prize > 700000) {
                    resultMessage = `‡πÅ‡∏à‡πá‡∏Ñ‡∏û‡∏≠‡∏ï‡πÅ‡∏ï‡∏Å! ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÉ‡∏´‡∏ç‡πà ${prize.toLocaleString()} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`;
                    playSound('positive');
                } else if (prize > 0) {
                    resultMessage = `‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• ${prize.toLocaleString()} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`;
                    playSound('positive');
                } else {
                    resultMessage = `‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡∏î‡πâ‡∏ß‡∏¢... ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏•‡∏¢!`;
                    playSound('negative');
                }
                
                elements.gambleResult.querySelector('p').textContent = resultMessage;
                elements.gambleResult.classList.remove('hidden');

                addLog(teamId, `‡∏à‡πà‡∏≤‡∏¢ 10,000 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏î‡∏î‡∏ß‡∏á... ‡πÅ‡∏•‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ${prize.toLocaleString()} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`);
                updateBankUI();
                updateTeamUI(teamId);

            }, 5000);
        }

        function closeGambleModal() {
            elements.gambleModal.classList.add('opacity-0', 'pointer-events-none');
        }
        
        // --- SUMMARY LOGIC ---
        function handleSummary() {
            initAudio();
            playSound('end');

            const team1 = teams[1];
            const team2 = teams[2];
            let winner, loser;

            if (team1.score > team2.score) {
                winner = team1;
                loser = team2;
            } else if (team2.score > team1.score) {
                winner = team2;
                loser = team1;
            }
            
            elements.summaryWinner.innerHTML = '';
            elements.summaryLoser.innerHTML = '';
            const punishmentReel = document.createElement('div');
            punishmentReel.className = 'font-pixel text-2xl text-yellow-400';
            elements.summaryPunishment.innerHTML = '';
            elements.summaryPunishment.appendChild(punishmentReel);

            elements.closeSummaryButton.classList.add('hidden');
            elements.summaryModal.classList.remove('opacity-0', 'pointer-events-none');

            const punishments = [
                "‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡∏ï‡∏ö 30 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
                "‡∏î‡∏±‡∏ô‡∏û‡∏∑‡πâ‡∏ô 20 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
                "‡πÅ‡∏û‡∏•‡∏á‡∏Ñ‡πå 2 ‡∏ô‡∏≤‡∏ó‡∏µ",
                "‡∏õ‡∏±‡πà‡∏ô‡∏à‡∏¥‡πâ‡∏á‡∏´‡∏£‡∏µ‡∏î 10 ‡∏£‡∏≠‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡∏£‡∏á",
                "‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ"
            ];

            if (loser) {
                playSound('gamble_reel', 5);
                const reelInterval = setInterval(() => {
                    const randomPunishment = punishments[Math.floor(Math.random() * punishments.length)];
                    punishmentReel.textContent = randomPunishment;
                }, 100);

                setTimeout(() => {
                    clearInterval(reelInterval);
                    const finalPunishment = punishments[Math.floor(Math.random() * punishments.length)];
                    elements.summaryWinner.innerHTML = `<h4 class="text-lg font-bold">‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞ <i class="fa-solid fa-crown text-yellow-400"></i></h4><p class="font-pixel text-2xl" style="color: ${winner.color};">${winner.name}</p><p class="text-xl font-bold">${winner.score.toLocaleString()} PTS</p>`;
                    elements.summaryLoser.innerHTML = `<h4 class="text-lg font-bold">‡∏ú‡∏π‡πâ‡πÅ‡∏û‡πâ</h4><p class="font-pixel text-2xl" style="color: ${loser.color};">${loser.name}</p><p class="text-xl font-bold">${loser.score.toLocaleString()} PTS</p>`;
                    elements.summaryPunishment.innerHTML = `<h4 class="text-lg font-bold text-red-500">‡∏ö‡∏ó‡∏•‡∏á‡πÇ‡∏ó‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÅ‡∏û‡πâ</h4><p class="text-2xl font-bold text-white">${finalPunishment}</p>`;
                    elements.closeSummaryButton.classList.remove('hidden');
                }, 5000);
            } else { // Draw
                elements.summaryWinner.innerHTML = `<h4 class="font-pixel text-2xl text-yellow-400">‡πÄ‡∏™‡∏°‡∏≠!</h4>`;
                elements.summaryLoser.innerHTML = `<p class="text-xl font-bold">${team1.score.toLocaleString()} PTS</p>`;
                elements.summaryPunishment.innerHTML = `<h4 class="text-lg font-bold">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÅ‡∏û‡πâ!</h4><p class="text-2xl font-bold text-white">‡∏£‡∏≠‡∏î‡∏ï‡∏±‡∏ß‡πÑ‡∏õ‡∏ô‡∏∞!</p>`;
                elements.closeSummaryButton.classList.remove('hidden');
            }
        }

        function closeSummaryModal() {
            elements.summaryModal.classList.add('opacity-0', 'pointer-events-none');
        }

        // --- SPECIAL EVENTS ---
        function triggerRandomEvent() {
            if (currentEvent) return; // Don't trigger if one is already active

            const possibleEvents = ['BLOOD_MOON', 'MARKET_CRASH', null, null, null]; // Higher chance of no event
            const event = possibleEvents[Math.floor(Math.random() * possibleEvents.length)];

            if (event === 'BLOOD_MOON') {
                currentEvent = 'BLOOD_MOON';
                elements.eventBannerContainer.innerHTML = `
                    <div class="panel p-4 text-center border-red-500 event-banner">
                        <h3 class="font-pixel text-red-500 text-lg mb-2">BLOOD MOON!</h3>
                        <p class="text-white">‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏Ç‡∏∂‡πâ‡∏ô 50% ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ 1 ‡∏ô‡∏≤‡∏ó‡∏µ!</p>
                    </div>`;
                playSound('negative');
                setTimeout(() => {
                    currentEvent = null;
                    elements.eventBannerContainer.innerHTML = '';
                }, 60000); // 1 minute duration
            } else if (event === 'MARKET_CRASH') {
                elements.eventBannerContainer.innerHTML = `
                    <div class="panel p-4 text-center border-yellow-500 event-banner">
                        <h3 class="font-pixel text-yellow-500 text-lg mb-2">MARKET CRASH!</h3>
                        <p class="text-white">‡∏ï‡∏•‡∏≤‡∏î‡∏´‡∏∏‡πâ‡∏ô‡∏•‡πà‡∏°! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°‡∏•‡∏î‡∏•‡∏á 15%!</p>
                    </div>`;
                playSound('negative');
                const loss1 = Math.floor(teams[1].score * 0.15);
                const loss2 = Math.floor(teams[2].score * 0.15);
                teams[1].score -= loss1;
                teams[2].score -= loss2;
                bankScore += loss1 + loss2;
                updateBankUI();
                addLog(null, `‡∏ï‡∏•‡∏≤‡∏î‡∏´‡∏∏‡πâ‡∏ô‡∏•‡πà‡∏°! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°‡∏•‡∏î‡∏•‡∏á 15%!`);
                updateTeamUI(1);
                updateTeamUI(2);
                setTimeout(() => {
                    elements.eventBannerContainer.innerHTML = '';
                }, 10000); // Display for 10 seconds
            }
        }
        
        // --- TROLL BUTTONS & RESET ---
        function handleResetGame() {
            showCustomConfirm('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏Å‡∏°?', '‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?', 'ü§î', () => {
                teams[1].score = 100000;
                teams[2].score = 100000;
                bankScore = 1000000000000;
                feedEvents.length = 0;
                updateTeamUI(1);
                updateTeamUI(2);
                updateBankUI();
                renderBattleLog();
                addLog(null, '‡πÄ‡∏Å‡∏°‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï!');
                playSound('end');
            });
        }
        
        function handleRobinHood() {
            const leaderId = teams[1].score > teams[2].score ? 1 : 2;
            const trailerId = leaderId === 1 ? 2 : 1;
            
            if (teams[1].score === teams[2].score) {
                addLog(null, '‡πÇ‡∏£‡∏ö‡∏¥‡∏ô‡∏Æ‡∏π‡πâ‡∏î‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ï‡∏±‡∏ß ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏∞‡∏õ‡∏•‡πâ‡∏ô‡πÉ‡∏Ñ‡∏£!');
                playSound('negative');
                return;
            }

            const amount = Math.floor(teams[leaderId].score * 0.25);
            teams[leaderId].score -= amount;
            teams[trailerId].score += amount;
            
            addLog(null, `‡πÇ‡∏£‡∏ö‡∏¥‡∏ô‡∏Æ‡∏π‡πâ‡∏î‡∏õ‡∏•‡πâ‡∏ô ${amount.toLocaleString()} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏° ${teams[leaderId].name} ‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏° ${teams[trailerId].name}!`);
            playSound('positive');
            updateTeamUI(1);
            updateTeamUI(2);
        }

        function handleBlindBet() {
            addLog(null, '‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏ï‡∏≤‡∏ö‡∏≠‡∏î! ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ó‡∏µ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏ß‡∏±‡∏î‡∏î‡∏ß‡∏á!');
            playSound('negative');
            setTimeout(() => handleGamble(1), 500);
            setTimeout(() => handleGamble(2), 6000); // Delay second gamble
        }

        function handleRandomEventButton() {
            const luckyTeamId = Math.random() < 0.5 ? 1 : 2;
            const unluckyTeamId = luckyTeamId === 1 ? 2 : 1;
            teams[luckyTeamId].score += 50000;
            teams[unluckyTeamId].score -= 25000;
            bankScore -= (50000 - 25000);
            updateBankUI();
            addLog(null, `‡πÇ‡∏ä‡∏Ñ‡∏ä‡∏∞‡∏ï‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡∏° ${teams[luckyTeamId].name}! ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 50,000 ‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡∏° ${teams[unluckyTeamId].name} ‡πÄ‡∏™‡∏µ‡∏¢ 25,000!`);
            playSound('positive');
            updateTeamUI(1);
            updateTeamUI(2);
        }
        
        // --- LOAN LOGIC ---
        function handleLoan(teamId) {
            const teamData = teams[teamId];
            if (teamData.debt) {
                // Repay debt
                if (teamData.score >= teamData.debt.amount) {
                    teamData.score -= teamData.debt.amount;
                    bankScore += teamData.debt.amount;
                    addLog(teamId, `‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ ${teamData.debt.amount.toLocaleString()} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!`);
                    clearInterval(teamData.debt.interval);
                    teamData.debt = null;
                    playSound('positive');
                } else {
                    addLog(teamId, `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ!`);
                    playSound('negative');
                }
            } else {
                // Take a loan
                const loanAmountInput = document.getElementById(`team${teamId}-loan-amount`);
                const amount = parseInt(loanAmountInput.value, 10);
                if (!isNaN(amount) && amount > 0 && bankScore >= amount) {
                    teamData.score += amount;
                    bankScore -= amount;
                    teamData.debt = {
                        principal: amount,
                        amount: amount,
                        interval: setInterval(() => {
                            const interest = Math.floor(teamData.debt.principal * 0.20);
                            teamData.debt.amount += interest;
                            addLog(teamId, `‡πÇ‡∏î‡∏ô‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ ${interest.toLocaleString()}! ‡∏¢‡∏≠‡∏î‡∏´‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô ${teamData.debt.amount.toLocaleString()}`);
                            updateTeamUI(teamId);
                        }, 600000) // 10 minutes
                    };
                    addLog(teamId, `‡∏Å‡∏π‡πâ‡∏¢‡∏∑‡∏° ${amount.toLocaleString()} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
                    playSound('positive');
                    loanAmountInput.value = '';
                } else {
                    addLog(teamId, `‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏¢‡∏∑‡∏°‡πÑ‡∏î‡πâ! (‡∏¢‡∏≠‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏û‡∏≠)`);
                    playSound('negative');
                }
            }
            updateBankUI();
            updateTeamUI(teamId);
        }
        
        // --- BUY CARDS LOGIC ---
        function handleBuyCards(teamId) {
            const teamData = teams[teamId];
            const teamElements = elements[`team${teamId}`];
            const quantity = parseInt(teamElements.buyAmountInput.value, 10);
            
            if (isNaN(quantity) || quantity <= 0) {
                addLog(teamId, `‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠!`);
                playSound('negative');
                return;
            }
            
            const totalCost = quantity * 50000;
            
            if (teamData.score >= totalCost) {
                teamData.score -= totalCost;
                bankScore += totalCost;
                updateBankUI();
                addLog(teamId, `‡∏ã‡∏∑‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡πå‡∏î ${quantity} ‡πÉ‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÄ‡∏™‡∏µ‡∏¢‡πÑ‡∏õ ${totalCost.toLocaleString()} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`);
                playSound('positive');
                teamElements.buyAmountInput.value = '';
                updateTeamUI(teamId);
            } else {
                addLog(teamId, `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏ã‡∏∑‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡πå‡∏î! (‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${totalCost.toLocaleString()})`);
                playSound('negative');
            }
        }
        
        // --- BLACK MARKET ---
        function handleBlackMarket(teamId) {
            const cost = 250000;
            const teamData = teams[teamId];

            if (teamData.score < cost) {
                addLog(teamId, `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏•‡∏≤‡∏î‡∏°‡∏∑‡∏î! (‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${cost.toLocaleString()})`);
                playSound('negative');
                return;
            }

            teamData.score -= cost;
            bankScore += cost;
            updateBankUI();
            updateTeamUI(teamId);
            
            addLog(teamId, `‡∏à‡πà‡∏≤‡∏¢ ${cost.toLocaleString()} ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏•‡∏≤‡∏î‡∏°‡∏∑‡∏î...`);
            playSound('gamble_reel', 2);

            setTimeout(() => {
                const legendaryCards = Object.keys(cardDatabase).filter(k => k > '0045');
                const randomCard = legendaryCards[Math.floor(Math.random() * legendaryCards.length)];
                activeTeam = teamId;
                showCardInfo(randomCard);
            }, 2000);
        }


        elements.team1.name.addEventListener('input', (e) => { teams[1].name = e.target.value; });
        elements.team2.name.addEventListener('input', (e) => { teams[2].name = e.target.value; });
        elements.team1.color.addEventListener('input', (e) => { teams[1].color = e.target.value; updateTeamUI(1); });
        elements.team2.color.addEventListener('input', (e) => { teams[2].color = e.target.value; updateTeamUI(2); });
        elements.team1.manualScore.addEventListener('keydown', (e) => handleManualScore(e, 1));
        elements.team2.manualScore.addEventListener('keydown', (e) => handleManualScore(e, 2));
        elements.team1.rfidInput.addEventListener('keydown', (e) => handleRfidInput(e, 1));
        elements.team2.rfidInput.addEventListener('keydown', (e) => handleRfidInput(e, 2));
        elements.closeAlertButton.addEventListener('click', closeCustomAlert);
        elements.closeGambleButton.addEventListener('click', closeGambleModal);
        elements.summaryButton.addEventListener('click', handleSummary);
        elements.closeSummaryButton.addEventListener('click', closeSummaryModal);
        elements.resetGameButton.addEventListener('click', handleResetGame);
        elements.trollRobinhoodButton.addEventListener('click', handleRobinHood);
        elements.trollBlindBetButton.addEventListener('click', handleBlindBet);
        elements.trollRandomButton.addEventListener('click', handleRandomEventButton);

        document.addEventListener('DOMContentLoaded', () => {
            const title = "TEAM BATTLE";
            const titleContainer = elements.mainTitle;
            title.split('').forEach((char, i) => {
                const span = document.createElement('span');
                span.textContent = char === ' ' ? '\u00A0' : char;
                span.className = 'title-char';
                span.style.animationDelay = `${i * 0.1}s`;
                titleContainer.appendChild(span);
            });

            updateTeamUI(1);
            updateTeamUI(2);
            updateBankUI();
            renderBattleLog();
            elements.team1.rfidInput.focus();
            
            // Start random event trigger loop (every 60-120 seconds)
            setInterval(triggerRandomEvent, Math.floor(Math.random() * 60000) + 60000);
        });
    </script>
</body>
</html>
